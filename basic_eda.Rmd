---
title: "basic_EDA"
author: "Vinay Maruri"
date: "`r Sys.Date()`"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(dplyr)
library(tidyverse)
library(forecast)
library(astsa)
library(vars)
library(marima)
library(fGarch)
```

```{r}
data <- read_csv("Data/cleaned_pollution_data.csv")
```

#start building a basic time series SO2 model

```{r}
so2_data <- data %>% filter(parameter == "SO2")
so2_data <- so2_data[, c("datetime_est", "site", "report_value")]

co_data <- data %>% filter(parameter == "CO")
co_data <- co_data[, c("datetime_est", "site", "report_value")]

ozone_data <- data %>% filter(parameter == "OZONE")
ozone_data <- ozone_data[, c("datetime_est", "site", "report_value")]

no_data <- data %>% filter(parameter == "NO")
no_data <- no_data[, c("datetime_est", "site", "report_value")]

no2_data <- data %>% filter(parameter == "NO2")
no2_data <- no2_data[, c("datetime_est", "site", "report_value")]

pm10b_data <- data %>% filter(parameter == "PM10B")
pm10b_data <- pm10b_data[, c("datetime_est", "site", "report_value")]

pm25b_data <- data %>% filter(parameter == "PM25B")
pm25b_data <- pm25b_data[, c("datetime_est", "site", "report_value")]

pm25t_data <- data %>% filter(parameter == "PM25T")
pm25t_data <- pm25t_data[, c("datetime_est", "site", "report_value")]
```

```{r, eval = F}
so2_data <- so2_data %>% filter(parameter == "SO2")
```


```{r}
#plotting the time series data
ggplot(so2_data, aes(x = datetime_est, y = report_value)) + 
  geom_line() + 
  labs(title= "SO2 Reported Value")

ggplot(co_data, aes(x = datetime_est, y = report_value)) +
  geom_line() + 
  labs(title= "CO Reported Value")

ggplot(ozone_data, aes(x = datetime_est, y = report_value)) +
  geom_line() + 
  labs(title= "Ozone Reported Value")

ggplot(no_data, aes(x = datetime_est, y = report_value)) +
  geom_line() + 
  labs(title= "NO Reported Value")

ggplot(no2_data, aes(x = datetime_est, y = report_value)) +
  geom_line() + 
  labs(title= "NO2 Reported Value")

ggplot(pm10b_data, aes(x = datetime_est, y = report_value)) +
  geom_line() + 
  labs(title= "PM10B Reported Value")

ggplot(pm25b_data, aes(x = datetime_est, y = report_value)) +
  geom_line() + 
  labs(title= "PM25B Reported Value")

ggplot(pm25t_data, aes(x = datetime_est, y = report_value)) +
  geom_line() + 
  labs(title= "PM25T Reported Value")
```

```{r}
#plot acf and pacf
acf(so2_data$report_value, lag.max = 50)
pacf(so2_data$report_value, lag.max = 50)

#plot acf and pacf
acf(co_data$report_value, lag.max = 50)
pacf(co_data$report_value, lag.max = 50)

#plot acf and pacf
acf(ozone_data$report_value, lag.max = 50)
pacf(ozone_data$report_value, lag.max = 50)

#plot acf and pacf
acf(no_data$report_value, lag.max = 50)
pacf(no_data$report_value, lag.max = 50)

#plot acf and pacf
acf(no2_data$report_value, lag.max = 50)
pacf(no2_data$report_value, lag.max = 50)

#plot acf and pacf
acf(pm10b_data$report_value, lag.max = 50)
pacf(pm10b_data$report_value, lag.max = 50)

#plot acf and pacf
acf(pm25b_data$report_value, lag.max = 50)
pacf(pm25b_data$report_value, lag.max = 50)

#plot acf and pacf
acf(pm25t_data$report_value, lag.max = 50)
pacf(pm25t_data$report_value, lag.max = 50)
```
We can clearly reject the white noise hypothesis as the acf and pacf plots show significant autocorrelations at various lags. 

```{r}
#decompose the time series data
lawrenceville_so2_data_ts <- ts(filter(so2_data, site == "Lawrenceville")$report_value, frequency = 24*365)
so2_data_decomp <- decompose(lawrenceville_so2_data_ts)

lawrenceville_co_data_ts <- ts(filter(co_data, site == "Lawrenceville")$report_value, frequency = 24*365)
co_data_decomp <- decompose(lawrenceville_co_data_ts)

lawrenceville_ozone_data_ts <- ts(filter(ozone_data, site == "Lawrenceville")$report_value, frequency = 24*365)
ozone_data_decomp <- decompose(lawrenceville_ozone_data_ts)

lawrenceville_no_data_ts <- ts(filter(no_data, site == "Lawrenceville")$report_value, frequency = 24*365)
no_data_decomp <- decompose(lawrenceville_no_data_ts)

lawrenceville_no2_data_ts <- ts(filter(no2_data, site == "Lawrenceville")$report_value, frequency = 24*365)
# no2_data_decomp <- decompose(lawrenceville_no2_data_ts)

lawrenceville_pm10b_data_ts <- ts(filter(pm10b_data, site == "Lawrenceville")$report_value, frequency = 24*365)
pm10b_data_decomp <- decompose(lawrenceville_pm10b_data_ts)

lawrenceville_pm25b_data_ts <- ts(filter(pm25b_data, site == "Lawrenceville")$report_value, frequency = 24*365)
pm25b_data_decomp <- decompose(lawrenceville_pm25b_data_ts)

lawrenceville_pm25t_data_ts <- ts(filter(pm25t_data, site == "Lawrenceville")$report_value, frequency = 24*365)
# pm25t_data_decomp <- decompose(lawrenceville_pm25t_data_ts)
```

```{r}
#plot the decomposed time series data
plot(so2_data_decomp)
plot(co_data_decomp)
plot(ozone_data_decomp)
plot(no_data_decomp)
#plot(no2_data_decomp)
plot(pm10b_data_decomp)
plot(pm25b_data_decomp)
# plot(pm25t_data_decomp)
```

so it appears that we have seasonality, a trend, and randomness in the data. 

```{r, eval = F}
#fit an ARIMA model
so2_data_arima <- auto.arima(liberty_so2_data_ts, max.p = 5, max.q = 5, max.order = 10, stationary = F, seasonal = T, allowdrift = T, trace = T, stepwise = F, approximation = F)

```

#arima(0, 1, 0) model is the best fit for the data? this didn't finish running on our data. 


#add external regressors to the arima model (wind speed/direction, temperature)
```{r}
liberty_only <- liberty_only[, c("datetime_est", "parameter", "report_value")]
#reshape data to wide format
liberty_only <- liberty_only %>% pivot_wider(names_from = c(parameter), values_from = report_value)
liberty_only <- liberty_only[, c("datetime_est", "SO2", "SONICWS", "SONICWD", "OUT_T", "INT_T")]
```

```{r}
#make a arima with external regressors
liberty_xt <- arima(liberty_only$SO2, order = c(0, 1, 0), xreg = liberty_only[, c("SONICWS", "SONICWD", "OUT_T", "INT_T")])
```

```{r}
#view the arima results
summary(liberty_xt)
```





